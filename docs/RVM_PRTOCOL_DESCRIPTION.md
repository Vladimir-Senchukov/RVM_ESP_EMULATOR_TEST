# Загальний пакет
Загальний пакет даних являє собою JSON пакет з полями 
{
	"address": "0" або "1"   // де 0 це Адреса ESP32_MOTORS 1 це адреса другої ESP32_PERIF
	
	"command": "0" - "16" або більше команд // кожна команда відповідає за певну дію яку має виконати єсп 
	
	"status": "0"- OK, "1"-NONE, "2"- ERROR, "3" - NOT_READY // В це поле Raspbery ставить 1 , ESP в це поле виставляе або 0, 2 або 3 після виконання команди 
	
	"data": "СТРІНГОВЕ ЗНАЧЕННЯ" // Сюди можна покласти корисну інформацію наприклад код штрих коду або деталі якщо наприклад стату ERROR то тут можна поставити чому саме ERROR
	
}

# Опис полів пакету

"**address**": "0" або "1"   // де 0 це Адреса ESP32_MOTORS, 1 це адреса другої ESP32_PERIF

"**command**": "0" - "16" або більше команд // кожна команда відповідає за певну дію яку має виконати ESP32

номера команд 
1 - Відкрити Діафрагму 
2 - Закрити Діафрагму
3 - LED зеленим
4 - LED червоним
5 - Чи підходить пляшка якщо status OK тоді все добре
інакше status ERROR і тоді треба прочитати в полі data чому саме "HEAVY_WEIGHT" або "NO_BARCODE"
6 - Запит штрих коду якщо статус OK тоді в полі data можна прочитати номер штрих коду "25489124487"
7 - Ввімкнути вали якщо status ERROR тоді в data має бути причина
8 - Вимкнути вали якщо status ERROR тоді в data має бути причина
9 - Розсунути вали
10 - Зсунути вали 
11 - Чи впала пляшка
12 - ввімкнути шредер 
13 - вимкнути шредер 
14 - Запит статусу по виконанню команд при цій команді в полі data треба вказати номер команди і тоді ESP32 віддасть останній статус по тій команді
15 - Причина Аварії 
16 - Чи немає руки

**==Тільки команди 5, 6,16 можна періодично повторювано посилати для того щоб отримати статус їх виконання. Статус всіх інших команд виконуєтся через команду 14.==**

"**status**": "0"- OK, "1"-NONE, "2"- ERROR "3" - 'NOT_READY' // В це поле Raspbery ставить 1 , ESP в це поле виставляє 0 або 2 після виконання команди . якщо виставляє ERROR то в полі data можна прочитати причину 

"**data**": "СТРІНГОВЕ ЗНАЧЕННЯ" // Сюди можна покласти корисну інформацію наприклад код штрих коду або деталі якщо наприклад статус ERROR то тут можна поставити чому саме ERROR

сommand: 1 
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 2 
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 3 
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 4 
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 5 
status: 3-"NOT_READY" - ESP буде віддавати цей статус поки результат не буде готовий
data: "OK"- невідомо, "NO_BARCODE" - баркод не розпізнаний або відсутній, 
HEAVY_WEIGHT"- вага пляшки завелика - також можна  додати якісь значення

сommand: 6 
status: 3-"NOT_READY" - ESP буде віддавати цей статус поки результат не буде готовий
data: "NONE"- невідомо, "Номер штрих коду", також можна  додати якісь значення

сommand: 7
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 8
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 9
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 10
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 11
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 12
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 13
data: "NONE"- невідомо також можна  додати якісь значення

сommand: 14
data: "NONE"- невідомо, або вставляется інші данні по яким прийшов запит, також можна  додати якісь значення

сommand: 15
data: "NONE"- невідомо також можна  додати якісь значення . Наприклад ми зрозуміли що заїв шредер і так далі 

сommand: 16 
status: 0 -"OK" якщо руки немає , 3-"NOT_READY" - ESP буде віддавати цей статус поки рука всередині
data: "NONE"- невідомо, або вставляется інші данні по яким прийшов запит, також можна  додати якісь значення

Rasppbery відправляє  address: 0 , command: 1, status: 1(NONE) , data: ""
ESP32 відправляє 
	 **у випадку успішного виконання:**  address:0, command: 1 , status: 0(OK), data: ""
	 **у випадку НЕ успішного виконання:**  address:0, command: 1 , status: 2(ERROR), data: "ПРИЧИНА ПОМИЛКИ"

# Аварійні ситуації 

 Пропоную додати логіку щоб ESP відслідковували якісь аварійні ситуації і якщо щось сталось дьоргали GPIO на RASPPBERY тоді вона може зуинити процес аварійно і командо 15 зробити запит щоб дізнатись яка аварія сталась 

# Комунінкаційна логіка ESP32

#1 ESP слухає шину і якщо приймає пакет з своєю адресою то:
 1) Виконує команду 
 2) Після закінчення виконання зберігає статус виконання команди і данні про виконання зберігає собі в память що б якщо raspbery треба ще раз дізнатись який був статус по команді вона змогла цей запит зробити командою 14.
 3)  Відправляє по шині пакет з усією інформацією
 4) Знову слухає шину поки не прийде пакет з її адресою 
#2 ESP може виставити  GPIO аварії якщо під час виконання команди щось сталось і записати для команди 15 якийсь аварійний стан щоб Rasppbery могла дізнатись в чому причина. Після цього вона знову слухає шину.
